<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using Models &#8212; Effective Django</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0-pre',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Writing Views" href="views.html" />
    <link rel="prev" title="Creating a Django Project" href="getting-started.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-models">
<h1>Using Models<a class="headerlink" href="#using-models" title="Permalink to this headline">¶</a></h1>
<p>In this section you&#8217;ll learn how to configure Django to connect to a database, as well as the basics of creating Python classes (models) that represent information in the database.</p>
<div class="section" id="configuring-the-database">
<h2>Configuring the Database<a class="headerlink" href="#configuring-the-database" title="Permalink to this headline">¶</a></h2>
<p>Django includes support out of the box for MySQL, PostgreSQL, SQLite3, and Oracle. <a class="reference external" href="https://docs.python.org/2/library/sqlite3.html">SQLite3</a> is included with Python, so we&#8217;ll use it for our project for simplicity. If you were going to use MySQL, for example, you&#8217;d need to add <a class="reference external" href="https://pypi.python.org/pypi/MySQL-python">mysql-python</a> to your <code class="docutils literal"><span class="pre">requirements.txt</span></code> file. We&#8217;ll discuss using databases like MySQL and Postgres in <a href="#id1"><span class="problematic" id="id2">Deploying_</span></a>.</p>
<p>You can find the database configuration in <code class="docutils literal"><span class="pre">addressbook/settings.py</span></code>. The <code class="docutils literal"><span class="pre">settings.py</span></code> file contains the
Django configuration for our project. There are some settings that you
must specify &#8211; like the <code class="docutils literal"><span class="pre">DATABASES</span></code> configuration, for example &#8211; and others
that are optional. Django fills in some defaults when it generates the
project scaffolding, and the documentation contains a <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/settings/">full list of
settings</a>. You can also add your own settings here, if needed.</p>
<p>Django defaults to SQLite, so we&#8217;ll just look at the database configuration to make sure we understand it.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;db.sqlite3&#39;</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here we see that the <code class="docutils literal"><span class="pre">default</span></code> database is configured with the SQLite3 engine and will be named <code class="docutils literal"><span class="pre">db.sqlite3</span></code> in the project directory (<code class="docutils literal"><span class="pre">BASE_DIR</span></code>, defined near the top of <code class="docutils literal"><span class="pre">settings.py</span></code>).</p>
<p>Note that the database engine is specified as a string, and not a
direct reference to the Python object. This is because the settings
file needs to be easily importable, without triggering any side
effects. <strong>You should avoid adding imports to the settings file.</strong></p>
<p>You rarely need to import the settings file directly; Django imports
it for you, and makes it available as <code class="docutils literal"><span class="pre">django.conf.settings</span></code>. You
typically import your settings from <code class="docutils literal"><span class="pre">django.conf</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf</span> <span class="k">import</span> <span class="n">settings</span>
</pre></div>
</div>
<p>By referring to <code class="docutils literal"><span class="pre">django.conf.settings</span></code> your code doesn&#8217;t need to bake in assumptions about package names, etc: you can write Django _applications_ that can plug into different _projects_ in the future.</p>
</div>
<div class="section" id="creating-a-model">
<h2>Creating a Model<a class="headerlink" href="#creating-a-model" title="Permalink to this headline">¶</a></h2>
<p>Django models map (roughly) to a database table, and provide a place
to encapsulate business logic. All models subclass the base <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/models/instances/#django.db.models.Model">Model</a>
class, and contain field definitions. Let&#8217;s start by creating a simple
Contact model for our application in <code class="docutils literal"><span class="pre">contacts/models.py</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">Contact</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">,</span>
        <span class="p">])</span>
</pre></div>
</div>
<p>Django provides a set of <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/models/fields/">fields</a> that map to data types and different
validation rules. For example, the <code class="docutils literal"><span class="pre">EmailField</span></code> here maps to the
same column type as the <code class="docutils literal"><span class="pre">CharField</span></code>, but adds validation for the
data.</p>
<p>Once you&#8217;ve created or updated a model, you need to update your database with the changes. Django&#8217;s <code class="docutils literal"><span class="pre">makemigrations</span></code> command creates new migrations based on your code changes. The <code class="docutils literal"><span class="pre">migrate</span></code> command runs pending migrations.</p>
<p>Before we create the migration for our Contact model, let&#8217;s run the pending migrations. These are migrations included with the apps Django installs by default.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(addresses) $</span> python manage.py migrate
<span class="go">Operations to perform:</span>
<span class="go">  Apply all migrations: admin, auth, contenttypes, sessions</span>
<span class="go">Running migrations:</span>
<span class="go">  Applying contenttypes.0001_initial... OK</span>
<span class="go">  Applying auth.0001_initial... OK</span>
<span class="go">  Applying admin.0001_initial... OK</span>
<span class="go">  Applying admin.0002_logentry_remove_auto_add... OK</span>
<span class="go">  Applying contenttypes.0002_remove_content_type_name... OK</span>
<span class="go">  Applying auth.0002_alter_permission_name_max_length... OK</span>
<span class="go">  Applying auth.0003_alter_user_email_max_length... OK</span>
<span class="go">  Applying auth.0004_alter_user_username_opts... OK</span>
<span class="go">  Applying auth.0005_alter_user_last_login_null... OK</span>
<span class="go">  Applying auth.0006_require_contenttypes_0002... OK</span>
<span class="go">  Applying auth.0007_alter_validators_add_error_messages... OK</span>
<span class="go">  Applying auth.0008_alter_user_username_max_length... OK</span>
<span class="go">  Applying sessions.0001_initial... OK</span>
</pre></div>
</div>
<p>Now we&#8217;re ready to generate our new migration.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(addresses) $</span> python manage.py makemigrations
<span class="go">No changes detected</span>
</pre></div>
</div>
<p>That&#8217;s not quite what we expected: we definitely created a new model. Our Contact model isn&#8217;t detected here because we haven&#8217;t told the <em>Project</em> to use the <em>Application</em> yet.</p>
<p>The <code class="docutils literal"><span class="pre">INSTALLED_APPS</span></code> setting lists the applications that the project uses. These are listed as strings that map to Python packages. Django will import each and looks for a <code class="docutils literal"><span class="pre">models</span></code> module there. Add our Contacts app to the project&#8217;s <code class="docutils literal"><span class="pre">INSTALLED_APPS</span></code> setting in <code class="docutils literal"><span class="pre">settings.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;contacts&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Then run <code class="docutils literal"><span class="pre">makemigrations</span></code> again.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(addresses) $</span> python manage.py makemigrations
<span class="go">Migrations for &#39;contacts&#39;:</span>
<span class="go">  contacts\migrations\0001_initial.py</span>
<span class="go">    - Create model Contact</span>
</pre></div>
</div>
<p>Now run <code class="docutils literal"><span class="pre">migrate</span></code> again to actually create the table.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(addresses) $</span> python manage.py migrate
<span class="go">Operations to perform:</span>
<span class="go">  Apply all migrations: admin, auth, contacts, contenttypes, sessions</span>
<span class="go">Running migrations:</span>
<span class="go">  Applying contacts.0001_initial... OK</span>
</pre></div>
</div>
<p>Note that Django created a table named <code class="docutils literal"><span class="pre">contacts_contact</span></code> for the Contacts model: by default Django will name your tables using a combination of the application name and model name. You can override that with the <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/models/options/">model Meta</a> options.</p>
</div>
<div class="section" id="interacting-with-the-model">
<h2>Interacting with the Model<a class="headerlink" href="#interacting-with-the-model" title="Permalink to this headline">¶</a></h2>
<p>Now that the model has been synced to the database we can interact
with it using the interactive shell.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(addresses)$</span> python ./manage.py shell
<span class="go">Python 3.6.0 (v3.6.0:41df79263a11, Dec 23 2016, 07:18:10) [MSC v.1900 32 bit (Intel)] on win32</span>
<span class="go">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span>
<span class="go">(InteractiveConsole)</span>
<span class="gp">&gt;</span>&gt;&gt; from contacts.models import Contact
<span class="gp">&gt;</span>&gt;&gt; Contact.objects.all<span class="o">()</span>
<span class="go">&lt;QuerySet []&gt;</span>
<span class="gp">&gt;</span>&gt;&gt; Contact.objects.create<span class="o">(</span><span class="nv">first_name</span><span class="o">=</span><span class="s1">&#39;Nathan&#39;</span>, <span class="nv">last_name</span><span class="o">=</span><span class="s1">&#39;Yergler&#39;</span><span class="o">)</span>
<span class="go">&lt;Contact: Nathan Yergler&gt;</span>
<span class="gp">&gt;</span>&gt;&gt; Contact.objects.all<span class="o">()</span>
<span class="go">&lt;QuerySet [&lt;Contact: Nathan Yergler&gt;]&gt;</span>
<span class="gp">&gt;</span>&gt;&gt; <span class="nv">nathan</span> <span class="o">=</span> Contact.objects.get<span class="o">(</span><span class="nv">first_name</span><span class="o">=</span><span class="s1">&#39;Nathan&#39;</span><span class="o">)</span>
<span class="gp">&gt;</span>&gt;&gt; nathan
<span class="go">&lt;Contact: Nathan Yergler&gt;</span>
<span class="gp">&gt;</span>&gt;&gt; print<span class="o">(</span>nathan<span class="o">)</span>
<span class="go">Nathan Yergler</span>
<span class="gp">&gt;</span>&gt;&gt; nathan.id
<span class="go">1</span>
<span class="gp">&gt;</span>&gt;&gt;
</pre></div>
</div>
<p>There are a few new things here. First, the <code class="docutils literal"><span class="pre">manage.py</span> <span class="pre">shell</span></code> command gives us a interactive shell with Python&#8217;s path set up correctly for Django. If you try to run Python and just import your application, an Exception will be raised because Django doesn&#8217;t know which settings  to use, and therefore can&#8217;t map Model instances to the database.</p>
<p>Second, there&#8217;s this <code class="docutils literal"><span class="pre">objects</span></code> property on our model class. That&#8217;s the model&#8217;s <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/db/managers/">Manager</a>. If a single instance of a Model represents a row in the database, the Manager represents the table. The default model manager provides querying functionality, and can be customized. When we call <code class="docutils literal"><span class="pre">all()</span></code> or <code class="docutils literal"><span class="pre">filter()</span></code> or the Manager, a <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/models/querysets/#django.db.models.query.QuerySet">QuerySet</a> is returned. A QuerySet is iterable, and loads data from the database as needed.</p>
<p>Finally, there&#8217;s this <code class="docutils literal"><span class="pre">id</span></code> field that we didn&#8217;t define. Django adds
an <code class="docutils literal"><span class="pre">id</span></code> field as the primary key for your model, unless you <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/db/models/#automatic-primary-key-fields">specify
a primary key</a>.</p>
</div>
<div class="section" id="writing-a-test">
<h2>Writing a Test<a class="headerlink" href="#writing-a-test" title="Permalink to this headline">¶</a></h2>
<p>We have one method defined on our model, <code class="docutils literal"><span class="pre">__str__</span></code>, and this is a
good time to start writing tests. The <code class="docutils literal"><span class="pre">__str__</span></code> method of a model
will get used in quite a few places, and it&#8217;s entirely conceivable
it&#8217;d be exposed to end users. It&#8217;s worth writing a test so we
understand how we expect it to operate.</p>
<p>Django creates a <code class="docutils literal"><span class="pre">tests.py</span></code> file when it creates the application, so we&#8217;ll add our first test to that file in the contacts app.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.test</span> <span class="k">import</span> <span class="n">TestCase</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="k">import</span> <span class="n">Contact</span>


<span class="k">class</span> <span class="nc">ContactTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Contact model tests.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">contact</span> <span class="o">=</span> <span class="n">Contact</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s1">&#39;Smith&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">contact</span><span class="p">),</span>
            <span class="s1">&#39;John Smith&#39;</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>You can run the tests for your application using <code class="docutils literal"><span class="pre">manage.py</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>(addresses)$ python manage.py test
Creating test database for alias &#39;default&#39;...
System check identified no issues (0 silenced).
.
----------------------------------------------------------------------
Ran 1 test in 0.000s

OK
Destroying test database for alias &#39;default&#39;...
</pre></div>
</div>
<p>One thing to note before moving on is the first and
last line of output: &#8220;Creating test database&#8221; and &#8220;Destroying test
database&#8221;. Some tests need access to a database, and because we don&#8217;t
want to mingle test data with &#8220;real&#8221; data (for a variety of reasons,
not the least of which is determinism), Django helpfully creates a
test database for us before running the tests. Essentially it creates
a new database, and runs <code class="docutils literal"><span class="pre">migrate</span></code> on it. If you subclass from
Django&#8217;s <code class="docutils literal"><span class="pre">TestCase</span></code> (which we are), Django also resets any default
data after running each TestCase, so that changes in one test won&#8217;t
break or influence another.</p>
</div>
<div class="section" id="review">
<h2>Review<a class="headerlink" href="#review" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Models define the fields in a table, and can contain business logic.</li>
<li>The <code class="docutils literal"><span class="pre">makemigrations</span></code> manage command creates migrations based on your Python models</li>
<li>The <code class="docutils literal"><span class="pre">migrate</span></code> manage command runs any pending migrations</li>
<li>The model <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/db/managers/">Manager</a> allows you to operate on the collection of
instances: querying, creating, etc.</li>
<li>Write unit tests for methods you add to the model</li>
<li>The <code class="docutils literal"><span class="pre">test</span></code> manage command runs the unit tests</li>
</ul>
</div>
</div>



            
              
              <div class="page_footer">
              <h4>Next</h4>
                <a href="views.html">Writing Views</a>
              </div>
              
            
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Effective Django</a></h1>











<h3>&nbsp;</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Getting Started with Django</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting-started.html">Creating a Django Project</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuring-the-database">Configuring the Database</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-model">Creating a Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interacting-with-the-model">Interacting with the Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-a-test">Writing a Test</a></li>
<li class="toctree-l3"><a class="reference internal" href="#review">Review</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="views.html">Writing Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="static.html">Using Static Assets</a></li>
<li class="toctree-l2"><a class="reference internal" href="additional-views.html">Additional Generic Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="forms.html">Form Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="related.html">Related Models</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../02_production/index.html">Building for Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_advanced/index.html">Advanced Django</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgments.html">Acknowledgments</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Getting Started with Django</a><ul>
      <li>Previous: <a href="getting-started.html" title="previous chapter">Creating a Django Project</a></li>
      <li>Next: <a href="views.html" title="next chapter">Writing Views</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<h3>Donate</h3>
<p>
Consider supporting the authors on <a href="https://www.gratipay.com/">Gratipay</a>:
</p>
<script data-gratipay-teamslug="effectivedjango"
  src="https://grtp.co/v2.js" async></script>

        </div>
      </div>
      <div class="clearer"></div>
  </div>


    <div class="footer">
      &copy;2012-2017, Nathan R. Yergler.
      
      |
      <a href="../_sources/01_intro/models.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>