
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Form Basics &#8212; Effective Django</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0-pre',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Related Models" href="related.html" />
    <link rel="prev" title="Additional Generic Views" href="additional-views.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="form-basics">
<h1>Form Basics<a class="headerlink" href="#form-basics" title="Permalink to this headline">¶</a></h1>
<p>Up until this point we’ve been using forms without really needing to
be aware of it. A <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/forms/">Django Form</a> is responsible for taking some user
input, validating it, and turning it into Python objects. They also
have some handy rendering methods, but I consider those sugar: the
real power is in making sure that input from your users is what it
says it is.</p>
<p>The <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/class-based-views/">Generic Views</a>, specifically the ones we’ve been using, all
operate on a particular model. Django is able to take the model
definition that we’ve created and extrapolate a Form from it. Django
can do this because both Models and Forms are constructed of fields
that have a particular type and particular validation rules. Models
use those fields to map data to types that your database understands;
Forms use them to map input to Python types <a class="footnote-reference" href="#id2" id="id1">[1]</a>. Forms that map to a
particular Model are called <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/forms/modelforms">ModelForms</a>; you can think of them as
taking user input and transforming it into an instance of a Model.</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>While I’m referring to them both as fields, they’re really
completely different implementations. But the analogy holds.</td></tr>
</tbody>
</table>
<div class="section" id="adding-fields-to-the-form">
<h2>Adding Fields to the Form<a class="headerlink" href="#adding-fields-to-the-form" title="Permalink to this headline">¶</a></h2>
<p>So what if we want to add a field to our form? Say, we want to require
confirmation of the email address. In that case we can create a new
form, and override the default used by our views.</p>
<p>First, in the <code class="docutils literal"><span class="pre">contacts</span></code> app directory, we’ll create a new file,
<code class="docutils literal"><span class="pre">forms.py</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django</span> <span class="k">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="k">import</span> <span class="n">ValidationError</span>

<span class="kn">from</span> <span class="nn">contacts.models</span> <span class="k">import</span> <span class="n">Contact</span>


<span class="k">class</span> <span class="nc">ContactForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>

    <span class="n">confirm_email</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Confirm email&quot;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Contact</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;instance&#39;</span><span class="p">):</span>
            <span class="n">email</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">email</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;initial&#39;</span><span class="p">,</span> <span class="p">{})[</span><span class="s1">&#39;confirm_email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">email</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ContactForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</pre></div>
</div>
<p>Here we’re creating a new <code class="docutils literal"><span class="pre">ModelForm</span></code>; we associate the form with
our model in the <code class="docutils literal"><span class="pre">Meta</span></code> inner class.</p>
<p>We’re also adding an additional field, <code class="docutils literal"><span class="pre">confirm_email</span></code>. This is an
example of a field declaration in a model. The first argument is the
label, and then there are additional keyword arguments; in this case,
we simply mark it required.</p>
<p>Finally, in the constructor we mutate the <code class="docutils literal"><span class="pre">initial</span></code> kwarg.
<code class="docutils literal"><span class="pre">initial</span></code> is a dictionary of values that will be used as the default
values for an <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/forms/api/#ref-forms-api-bound-unbound">unbound form</a>. Model Forms have another kwarg,
<code class="docutils literal"><span class="pre">instance</span></code>, that holds the instance we’re editing.</p>
</div>
<div class="section" id="overriding-the-default-form">
<h2>Overriding the Default Form<a class="headerlink" href="#overriding-the-default-form" title="Permalink to this headline">¶</a></h2>
<p>We’ve defined a form with the extra field, but we still need to tell
our view to use it. You can do this in a couple of ways, but the
simplest is to set the <code class="docutils literal"><span class="pre">form_class</span></code> property on the View class.
We’ll add that property to our <code class="docutils literal"><span class="pre">CreateContactView</span></code> and
<code class="docutils literal"><span class="pre">UpdateContactView</span></code> in <code class="docutils literal"><span class="pre">views.py</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">forms</span>
<span class="o">...</span>
<span class="k">class</span> <span class="nc">CreateContactView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">Contact</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;edit_contact.html&#39;</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ContactForm</span>

</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UpdateContactView</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">Contact</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;edit_contact.html&#39;</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ContactForm</span>

</pre></div>
</div>
<p>If we fire up the server and visit the edit or create pages, we’ll see
the additional field. We can see that it’s required, but there’s no
validation that the two fields match. To support that we’ll need to
add some custom validation to the Form.</p>
</div>
<div class="section" id="customizing-validation">
<h2>Customizing Validation<a class="headerlink" href="#customizing-validation" title="Permalink to this headline">¶</a></h2>
<p>Forms have two different phases of validation: field and form. All the
fields are validated and converted to Python objects (if possible)
before form validation begins.</p>
<p>Field validation takes place for an individual field: things like
minimum and maximum length, making sure it looks like a URL, and date
range validation are all examples of field validation. Django doesn’t
guarantee that field validation happens in any order, so you can’t
count on other fields being available for comparison during this
phase.</p>
<p>Form validation, on the other hand, happens after all fields have been
validated and converted to Python objects, and gives you the
opportunity to do things like make sure passwords match, or in this
case, email addresses.</p>
<p>Form validation takes place in a form’s <code class="docutils literal"><span class="pre">clean()</span></code> method.</p>
<p>When you enter the <code class="docutils literal"><span class="pre">clean</span></code> method, all of the fields that validated
are available in the <code class="docutils literal"><span class="pre">cleaned_data</span></code> dictionary. The <code class="docutils literal"><span class="pre">clean</span></code> method
may add, remove, or modify values, but <strong>must</strong> return the dictionary
of cleaned data. <code class="docutils literal"><span class="pre">clean</span></code> may also raise a <code class="docutils literal"><span class="pre">ValidationError</span></code> if it
encounters an error. This will be available as part of the forms’
<code class="docutils literal"><span class="pre">errors</span></code> property, and is shown by default when you render the form.</p>
<p>Note that I said <code class="docutils literal"><span class="pre">cleaned_data</span></code> contains all the fields <em>that
validated</em>. That’s because form-level validation <strong>always</strong> happens,
even if no fields were successfully validated. That’s why in the clean
method we use <code class="docutils literal"><span class="pre">cleaned_data.get('email')</span></code> instead of
<code class="docutils literal"><span class="pre">cleaned_data['email']</span></code>.</p>
<p>If you visit the create or update views now, we’ll see an extra field
there. Try to make a change, or create a contact, without entering the
email address twice.</p>
</div>
<div class="section" id="controlling-form-rendering">
<h2>Controlling Form Rendering<a class="headerlink" href="#controlling-form-rendering" title="Permalink to this headline">¶</a></h2>
<p>Our templates until now look pretty magical when it comes to forms:
the extent of our HTML tags has been something like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;{{ action }}&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
  <span class="p">{</span><span class="o">%</span> <span class="n">csrf_token</span> <span class="o">%</span><span class="p">}</span>
  <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
    <span class="p">{{</span> <span class="n">form</span><span class="o">.</span><span class="n">as_ul</span> <span class="p">}}</span>
  <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Save&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>We’re living at the whim of <code class="docutils literal"><span class="pre">form.as_ul</span></code>, and it’s likely we want
something different.</p>
<p>Forms have three pre-baked output formats: <code class="docutils literal"><span class="pre">as_ul</span></code>, <code class="docutils literal"><span class="pre">as_p</span></code>, and
<code class="docutils literal"><span class="pre">as_table</span></code>. If <code class="docutils literal"><span class="pre">as_ul</span></code> outputs the form elements as the items in
an unordered list, it’s not too mysterious what <code class="docutils literal"><span class="pre">as_p</span></code> and
<code class="docutils literal"><span class="pre">as_table</span></code> do.</p>
<p>Often, though, you need more control. For those cases, you can take
full control. First, a form is iterable; try replacing your call to
<code class="docutils literal"><span class="pre">{{form.as_ul}}</span></code> with this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">form</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{{</span> <span class="n">field</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>As you can see, <code class="docutils literal"><span class="pre">field</span></code> renders as the input for each field in the
form. When you iterate over a Form, you’re iterating over a sequence
of <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/forms/api/#django.forms.BoundField">BoundField</a> objects. A <code class="docutils literal"><span class="pre">BoundField</span></code> wraps the field definition
from your Form (or derived from the ModelForm) along with any data and
error state it may be bound to. This means it has some properties that
are handy for customizing rendering.</p>
<p>In addition to supporting iteration, you can access an individual
BoundField directly, treating the Form like a dictionary:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">form</span><span class="o">.</span><span class="n">email</span> <span class="p">}}</span>
</pre></div>
</div>
<div class="sidebar">
<p class="first sidebar-title">Dictionary!?!</p>
<p class="last">That may not look like a dictionary access, but remember that Django
templates are quite restrictive in their syntax. Writing <code class="docutils literal"><span class="pre">foo.bar</span></code>
will look for a property <code class="docutils literal"><span class="pre">bar</span></code> on <code class="docutils literal"><span class="pre">foo</span></code>, and if it’s callable,
call it. If it doesn’t find a property, it’ll map that to something
like <code class="docutils literal"><span class="pre">foo['bar']</span></code>. So when it comes to writing Django templates,
dictionary elements act just like properties.</p>
</div>
<p>Consider the following alternative to <code class="docutils literal"><span class="pre">edit_contact.html</span></code>.</p>
<div class="highlight-django"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">if</span> <span class="nv">contact.id</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;h1&gt;Edit Contact&lt;/h1&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;h1&gt;Add Contact&lt;/h1&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">&lt;form action=&quot;</span><span class="cp">{{</span> <span class="nv">action</span> <span class="cp">}}</span><span class="x">&quot; method=&quot;POST&quot;&gt;</span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.non_field_errors</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;ul&gt;</span>
<span class="x">      </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">error</span> <span class="k">in</span> <span class="nv">form.non_field_errors</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">        &lt;li&gt;</span><span class="cp">{{</span> <span class="nv">error</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="x">      </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;/ul&gt;</span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">field</span> <span class="k">in</span> <span class="nv">form</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  &lt;div id=&quot;</span><span class="cp">{{</span> <span class="nv">field.auto_id</span> <span class="cp">}}</span><span class="x">_container&quot;&gt;</span>
<span class="x">    </span><span class="cp">{{</span> <span class="nv">field.help_text</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">    &lt;div&gt;</span>
<span class="x">      </span><span class="cp">{{</span> <span class="nv">field.label_tag</span> <span class="cp">}}</span><span class="x"> </span><span class="cp">{{</span> <span class="nv">field</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">    &lt;div id=&quot;</span><span class="cp">{{</span> <span class="nv">field.auto_id</span> <span class="cp">}}</span><span class="x">_errors&quot;&gt;</span>
<span class="x">      </span><span class="cp">{{</span> <span class="nv">field.errors</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">  &lt;/div&gt;</span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">  &lt;input id=&quot;save_contact&quot; type=&quot;submit&quot; value=&quot;Save&quot; /&gt;</span>
<span class="x">&lt;/form&gt;</span>

<span class="cp">{%</span> <span class="k">if</span> <span class="nv">contact.id</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s2">&quot;contacts-edit-addresses&quot;</span> <span class="nv">pk</span><span class="o">=</span><span class="nv">contact.id</span> <span class="cp">%}</span><span class="x">&quot;&gt;</span>
<span class="x">  Edit Addresses</span>
<span class="x">&lt;/a&gt;</span>
<span class="x">&lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s2">&quot;contacts-delete&quot;</span> <span class="nv">pk</span><span class="o">=</span><span class="nv">contact.id</span> <span class="cp">%}</span><span class="x">&quot;&gt;Delete&lt;/a&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">&lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s2">&quot;contacts-list&quot;</span> <span class="cp">%}</span><span class="x">&quot;&gt;back to list&lt;/a&gt;</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>In this example we see a few different things at work:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">field.auto_id</span></code> to get the automatically generated field ID</p>
</li>
<li><p class="first">Combining that ID with <code class="docutils literal"><span class="pre">_container</span></code> and <code class="docutils literal"><span class="pre">_errors</span></code> to give our
related elements names that consistently match</p>
</li>
<li><p class="first">Using <code class="docutils literal"><span class="pre">field.label_tag</span></code> to generate the label. <code class="docutils literal"><span class="pre">label_tag</span></code> adds
the appropriate <code class="docutils literal"><span class="pre">for</span></code> property to the tag, too. For the
<code class="docutils literal"><span class="pre">last_name</span></code> field, this looks like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;id_last_name&quot;</span><span class="o">&gt;</span><span class="n">Last</span> <span class="n">name</span><span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Using <code class="docutils literal"><span class="pre">field.errors</span></code> to show the errors in a specific place. The
Django Form documentation has details on further customizing <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/forms/api/#how-errors-are-displayed">how
errors are displayed</a>.</p>
</li>
<li><p class="first">Finally, <code class="docutils literal"><span class="pre">field.help_text</span></code>. You can specify a <code class="docutils literal"><span class="pre">help_text</span></code>
keyword argument to each field when creating your form, which is
accessible here. Defining that text in the Form definition is
desirable because you can easily mark it up for translation.</p>
</li>
</ul>
</div>
<div class="section" id="testing-forms">
<h2>Testing Forms<a class="headerlink" href="#testing-forms" title="Permalink to this headline">¶</a></h2>
<p>It’s easy to imagine how you’d use the <code class="docutils literal"><span class="pre">LiveServerTestCase</span></code> to write
an integration test for a Form. But that wouldn’t just be testing the
Form, that’d be testing the View, the URL configuration, and probably
the Model (in this case, at least). We’ve built some custom logic into
our form’s validator, and it’s important to test that and that alone.
Integration tests are invaluable, but when they fail there’s more than
one suspect. I like tests that fail with a single suspect.</p>
<p>Writing unit tests for a Form usually means crafting some dictionary
of form data that meets the starting condition for your test. Some
Forms can be complex or long, so we can use a helper to generate the
starting point from the Form’s initial data.</p>
<p><strong>Rebar</strong> is a collection of utilities for working with Forms. We’ll
install Rebar so we can use the testing utilities.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>(tutorial)$ pip install rebar
</pre></div>
</div>
<p>Then we can write a unit test that tests two cases: success (email
addresses match) and failure (they do not).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rebar.testing</span> <span class="k">import</span> <span class="n">flatten_to_dict</span>
<span class="kn">from</span> <span class="nn">contacts</span> <span class="k">import</span> <span class="n">forms</span>
<span class="o">...</span>
<span class="k">class</span> <span class="nc">EditContactFormTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_mismatch_email_is_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">form_data</span> <span class="o">=</span> <span class="n">flatten_to_dict</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ContactForm</span><span class="p">())</span>
        <span class="n">form_data</span><span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Foo&#39;</span>
        <span class="n">form_data</span><span class="p">[</span><span class="s1">&#39;last_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bar&#39;</span>
        <span class="n">form_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;foo@example.com&#39;</span>
        <span class="n">form_data</span><span class="p">[</span><span class="s1">&#39;confirm_email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar@example.com&#39;</span>

        <span class="n">bound_form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ContactForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">form_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">bound_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_same_email_is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">form_data</span> <span class="o">=</span> <span class="n">flatten_to_dict</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ContactForm</span><span class="p">())</span>
        <span class="n">form_data</span><span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Foo&#39;</span>
        <span class="n">form_data</span><span class="p">[</span><span class="s1">&#39;last_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bar&#39;</span>
        <span class="n">form_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;foo@example.com&#39;</span>
        <span class="n">form_data</span><span class="p">[</span><span class="s1">&#39;confirm_email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;foo@example.com&#39;</span>

        <span class="n">bound_form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ContactForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">form_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_</span><span class="p">(</span><span class="n">bound_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
</pre></div>
</div>
<p>An interesting thing to note here is the use of the <code class="docutils literal"><span class="pre">is_valid()</span></code>
method. We could just as easily introspect the <code class="docutils literal"><span class="pre">errors</span></code> property
that we used in our template above, but in this case we just need a
Boolean answer: is the form valid, or not? Note that we do need to
provide a first and last name, as well, since those are required
fields.</p>
</div>
<div class="section" id="review">
<h2>Review<a class="headerlink" href="#review" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Forms take user input, validate it, and convert it to Python objects</li>
<li>Forms are composed of Fields, just like Models</li>
<li>Fields have validation built in</li>
<li>You can customize per-field validation, as well as form validation</li>
<li>If you need to compare fields to one another, you need to implement
the <code class="docutils literal"><span class="pre">clean</span></code> method</li>
<li>Forms are iterable over, and support dictionary-like access to, the
bound fields</li>
<li>A Bound Field has properties and methods for performing fine-grained
customization of rendering.</li>
<li>Forms are unit testable; Rebar has some utilities to help with
testing large forms.</li>
</ul>
</div>
</div>



            
              
              <div class="page_footer">
              <h4>Next</h4>
                <a href="related.html">Related Models</a>
              </div>
              
            
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Effective Django</a></h1>










<h4><a href="../contents.html">Table of Contents</a></h4>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Getting Started with Django</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting-started.html">Creating a Django Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="models.html">Using Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="views.html">Writing Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="static.html">Using Static Assets</a></li>
<li class="toctree-l2"><a class="reference internal" href="additional-views.html">Additional Generic Views</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Form Basics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-fields-to-the-form">Adding Fields to the Form</a></li>
<li class="toctree-l3"><a class="reference internal" href="#overriding-the-default-form">Overriding the Default Form</a></li>
<li class="toctree-l3"><a class="reference internal" href="#customizing-validation">Customizing Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#controlling-form-rendering">Controlling Form Rendering</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-forms">Testing Forms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#review">Review</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="related.html">Related Models</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../02_production/index.html">Building for Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_advanced/index.html">Advanced Django</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgments.html">Acknowledgments</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../contents.html">Documentation overview</a><ul>
  <li><a href="index.html">Getting Started with Django</a><ul>
      <li>Previous: <a href="additional-views.html" title="previous chapter">Additional Generic Views</a></li>
      <li>Next: <a href="related.html" title="next chapter">Related Models</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<h3>Donate</h3>
<p>
Consider supporting the authors on <a href="https://www.gratipay.com/">Gratipay</a>:
</p>
<script data-gratipay-teamslug="effectivedjango"
  src="https://grtp.co/v2.js" async></script>

        </div>
      </div>
      <div class="clearer"></div>
  </div>


    <div class="footer">
      
      &copy; 2012-2017, <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.yergler.net/" property="cc:attributionName" rel="cc:attributionURL">Nathan Yergler</a>; licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0 license</a>.
      
      |
      <a href="../_sources/01_intro/forms.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>